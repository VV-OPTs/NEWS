<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>类报纸排版生成器</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&family=Playfair+Display:wght@700&family=Roboto:wght@400;700&family=Source+Code+Pro:wght@400;700&family=Comic+Neue:wght@700&family=Times+New+Roman&family=Courier+New&family=Arial&display=swap" rel="stylesheet">
    <style>
        * {margin: 0;padding: 0;box-sizing: border-box;}
        body {font-family: 'Noto Serif SC', serif;background-color: #f5f1e8;
            color: #333;line-height: 1.6;padding: 20px;}
        .container {max-width: 1600px;margin: 0 auto;display: flex;
            flex-direction: column;gap: 30px;}
        header {text-align: center;padding: 20px 0;border-bottom: 2px solid #8c2e2e;}
        h1 {font-family: 'Playfair Display', serif;color: #8c2e2e;font-size: 2.8rem;
            letter-spacing: 2px;margin-bottom: 10px;}
        .subtitle {font-size: 1.2rem;color: #666;font-style: italic;}
        .main-content {display: flex;flex-wrap: wrap;gap: 30px;}
        .editor-panel {flex: 1;min-width: 500px;background-color: #fff;
            padding: 25px;border-radius: 5px;box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-top: 8px solid #8c2e2e;max-height: 95vh;overflow-y: auto;}
        .newspaper-preview {flex: 2;min-width: 700px;
            background-color: #fff;padding: 40px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            position: relative;background-color: #faf8f2;}
        
        /* 新增：布局切换样式 */
        .layout-controls {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 15px;
            gap: 10px;
        }
        .layout-btn {
            padding: 8px 15px;
            background-color: #e0d6c2;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Noto Serif SC', serif;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
        }
        .layout-btn:hover {
            background-color: #d4c9b8;
        }
        .layout-btn.active {
            background-color: #8c2e2e;
            color: white;
        }
        .vertical-layout .main-content {
            flex-direction: column;
        }
        .vertical-layout .editor-panel,
        .vertical-layout .newspaper-preview {
            min-width: 100%;
            max-height: none;
        }
        
        .section-title {font-size: 1.4rem;color: #8c2e2e;margin-bottom: 20px;
            padding-bottom: 10px;border-bottom: 1px solid #e0d6c2;
            display: flex;align-items: center;gap: 10px;}
        .section-title i {font-size: 1.2rem;}
        .control-group {margin-bottom: 25px;padding: 15px;
            border-radius: 8px;background-color: #f9f7f1;}
        .control-group-image {background-color: #f0f7f0;}
        .control-group-header {background-color: #e6f0f6;}
        .control-group-title {background-color: #f0e6d6;}
        .control-group-text {background-color: #f0f4f8;}
        .control-group-footer {background-color: #f5f0e8;}
        .control-group-header-content {display: flex;
            justify-content: space-between;align-items: center;margin-bottom: 15px;}
        .control-group-header h3 {font-size: 1.1rem;color: #444;display: flex;
            align-items: center;gap: 8px;}
        .toggle-switch {position: relative;display: inline-block;width: 50px;height: 24px;}
        .toggle-switch input {opacity: 0;width: 0;height: 0;}
        .toggle-slider {position: absolute;cursor: pointer;top: 0;left: 0;right: 0;bottom: 0;
            background-color: #ccc;transition: .4s;border-radius: 24px;}
        .toggle-slider:before {position: absolute;content: "";height: 16px;
            width: 16px;left: 4px;bottom: 4px;background-color: white;
            transition: .4s;border-radius: 50%;}
        input:checked + .toggle-slider {background-color: #8c2e2e;}
        input:checked + .toggle-slider:before {transform: translateX(26px);}
        .control-row {display: flex;gap: 15px;margin-bottom: 15px;align-items: center;
            flex-wrap: wrap;}
        .control-item {flex: 1;min-width: 180px;}
        label {display: block;margin-bottom: 8px;font-weight: bold;color: #444;
            font-size: 0.95rem;}
        input[type="text"], textarea, select {width: 100%;padding: 10px;
            border: 1px solid #d4c9b8;border-radius: 4px;
            font-family: 'Noto Serif SC', serif;font-size: 1rem;
            background-color: #fff;transition: border-color 0.3s;}
        input[type="text"]:focus, textarea:focus, select:focus {outline: none;
            border-color: #8c2e2e;}
        textarea {min-height: 150px;resize: vertical;}
        .image-upload {border: 2px dashed #d4c9b8;border-radius: 4px;
            padding: 20px;text-align: center;cursor: pointer;transition: border-color 0.3s;
            background-color: #f9f7f1;}
        .image-upload:hover {border-color = '#8c2e2e';}
        .image-upload i {font-size: 2.5rem;color: #8c2e2e;margin-bottom: 10px;}
        #imagePreview {max-width: 100%;max-height: 200px;margin-top: 15px;display: none;}
        .font-size-control {display: flex;align-items: center;gap: 15px;}
        .font-size-control input {flex: 1;}
        .color-picker-container {display: flex;align-items: center;gap: 10px;}
        .color-picker {width: 50px;height: 40px;border: 1px solid #d4c9b8;
            border-radius: 4px;cursor: pointer;background-color: #fff;}
        .size-value, .color-value {font-weight: bold;color: #8c2e2e;min-width: 40px;
            font-size: 0.9rem;}
        .buttons {display: flex;gap: 15px;margin-top: 30px;}
        button {padding: 14px 24px;border: none;border-radius: 4px;
            font-family: 'Noto Serif SC', serif;font-size: 1rem;font-weight: bold;
            cursor: pointer;transition: all 0.3s;flex: 1;display: flex;
            align-items: center;justify-content: center;gap: 10px;}
        .generate-btn {background-color: #8c2e2e;color: white;}
        .generate-btn:hover {background-color: #6d2323;transform: translateY(-2px);}
        .download-btn {background-color: #2e5d8c;color: white;}
        .download-btn:hover {background-color: #24496e;transform: translateY(-2px);}
        .reset-btn {background-color: #e0d6c2;color: #333;}
        .reset-btn:hover {background-color: #d4c9b8;}
        
        /* 新增：保存和加载按钮样式 */
        .save-btn {background-color: #2e8c5d;color: white;}
        .save-btn:hover {background-color: #247349;transform: translateY(-2px);}
        .load-btn {background-color: #8c5d2e;color: white;}
        .load-btn:hover {background-color: #6d4923;transform: translateY(-2px);}
        
        /* 报纸样式 */
        .newspaper {font-family: 'Noto Serif SC', serif;background-color: #faf8f2;
            padding: 40px;border: 1px solid #d4c9b8;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.05);
            min-height: 800px;position: relative;overflow: hidden;transition: all 0.3s ease;}
        .newspaper::before {content: "";position: absolute;top: 0;left: 0;right: 0;bottom: 0;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23d4c9b8' fill-opacity='0.2' fill-rule='evenodd'/%3E%3C/svg%3E");
            opacity: 0.3;z-index: 0;}
        .newspaper-content {position: relative;z-index: 1;}
        .newspaper-header {border-bottom: 3px double #8c2e2e;padding-bottom: 15px;
            margin-bottom: 30px;text-align: center;}
        .paper-name {font-family: 'Playfair Display', serif;font-size: 3.5rem;
            letter-spacing: 3px;color: #222;margin-bottom: 5px;}
        .paper-date {font-style: italic;color: #666;font-size: 1.1rem;}
        .article-title {font-size: 2.5rem;font-weight: bold;line-height: 1.2;
            margin-bottom: 25px;color: #222;text-align: center;
            font-family: 'Playfair Display', serif;}
        .article-content {display: flex;flex-wrap: wrap;gap: 30px;margin-top: 30px;}
        .article-image-container {flex: 1;min-width: 300px;}
        .article-image {width: 100%;height: auto;border: 1px solid #d4c9b8;
            padding: 5px;background-color: white;box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);}
        .article-image-caption {font-size: 0.9rem;color: #666;font-style: italic;text-align: center;
            margin-top: 8px;padding-top: 8px;border-top: 1px dotted #d4c9b8;}
        .article-text {flex: 2;min-width: 300px;column-count: 2;column-gap: 30px;
            text-align: justify;hyphens: auto;}
        .article-text.no-image {flex: 1;min-width: 100%;column-count: 2;}
        .article-text p {margin-bottom: 15px;text-indent: 2em;}
        /* 删除首字母下沉设计 */
        .newspaper-footer {margin-top: 40px;padding-top: 20px;
            border-top: 1px solid #d4c9b8;font-size: 0.9rem;color: #666;text-align: center;}
        .generated-date {font-style: italic;}
        @media (max-width: 768px) {
            .main-content {flex-direction: column;}
            .editor-panel, .newspaper-preview {min-width: 100%;}
            .article-text {column-count: 1;}
            .article-title {font-size: 2rem;}
            .paper-name {font-size: 2.5rem;}
            .layout-controls {justify-content: center;}
            .layout-btn {font-size: 0.8rem;padding: 6px 10px;}
            .buttons {flex-wrap: wrap;}
            .buttons button {min-width: calc(50% - 7.5px);}}
        
        /* 新增：错误弹窗样式 */
        .error-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        .error-content {
            background-color: white;
            width: 90%;
            max-width: 500px;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        .error-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            color: #d32f2f;
            font-size: 1.5rem;
        }
        .error-header i {
            margin-right: 10px;
            font-size: 1.8rem;
        }
        .error-details {
            background-color: #f9f7f1;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 4px solid #d32f2f;
        }
        .error-solution {
            background-color: #f0f7f0;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 4px solid #2e8c5d;
        }
        .error-solution h4 {
            color: #2e8c5d;
            margin-bottom: 10px;
        }
        .error-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 25px;
        }
        .error-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Noto Serif SC', serif;
            font-weight: bold;
            transition: all 0.3s;
        }
        .error-btn-primary {
            background-color: #8c2e2e;
            color: white;
        }
        .error-btn-primary:hover {
            background-color: #6d2323;
        }
        .error-btn-secondary {
            background-color: #e0d6c2;
            color: #333;
        }
        .error-btn-secondary:hover {
            background-color: #d4c9b8;
        }
        
        .toast {position: fixed;bottom: 20px;right: 20px;background-color: #2e8c5d;
            color: white;padding: 15px 25px;border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);display: none;
            z-index: 1000;font-weight: bold;}
        footer {text-align: center;margin-top: 30px;padding-top: 20px;
            border-top: 1px solid #d4c9b8;color: #666;font-size: 0.9rem;}
        
        /* 字体预览样式 */
        .font-preview {margin-top: 5px;padding: 5px;
            font-size: 0.9rem;border-radius: 4px;background-color: #fff;
            border: 1px dashed #ddd;min-height: 30px;}
        
        /* 颜色预览 */
        .color-preview {width: 100%;height: 8px;border-radius: 4px;margin-top: 5px;}
        
        /* 小标题 */
        .control-subtitle {font-size: 0.9rem;color: #666;margin-top: -10px;margin-bottom: 15px;
            font-style: italic;}
        .image-control-header {display: flex;justify-content: space-between;
            align-items: center;margin-bottom: 15px;}
        .image-control-header h3 {margin: 0;font-size: 1.1rem;
            color: #444;display: flex;align-items: center;gap: 8px;}
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-newspaper"></i> 类报纸排版生成器</h1>
            <p class="subtitle">工具制作：@村里最乱炒的坏厨</p>
        </header>
        
        <!-- 新增：布局控制按钮 -->
        <div class="layout-controls">
            <button id="horizontalLayoutBtn" class="layout-btn active">
                <i class="fas fa-columns"></i> 左右布局
            </button>
            <button id="verticalLayoutBtn" class="layout-btn">
                <i class="fas fa-stream"></i> 上下布局
            </button>
        </div>
        
        <div class="main-content">
            <div class="editor-panel">
                <h2 class="section-title"><i class="fas fa-sliders-h"></i> 自定义设置</h2>
                <div class="control-group control-group-image">
                    <div class="image-control-header">
                        <h3><i class="fas fa-image"></i> 图片设置</h3>
                        <div>
                            <span style="margin-right: 10px; font-size: 0.9rem;">显示图片</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="imageVisible" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="control-subtitle">控制是否在报纸中显示图片</div>
                    <label for="imageUpload">上传图片</label>
                    <div class="image-upload" id="imageUpload">
                        <i class="fas fa-image"></i>
                        <p>点击此处上传图片，或拖放图片文件</p>
                        <input type="file" id="imageInput" accept="image/*" style="display: none;">
                        <img id="imagePreview" alt="预览">
                    </div>
                    <div class="control-row" style="margin-top: 15px;">
                        <div class="control-item">
                            <label for="imageCaption">图片说明文字</label>
                            <input type="text" id="imageCaption" placeholder="请输入图片说明文字..." value="上面可以插入图片，这里可以输入图片备注（当然吐槽碎碎念也没问题。">
                        </div>
                    </div>
                </div>
                <div class="control-group control-group-header">
                    <div class="control-group-header-content">
                        <h3><i class="fas fa-newspaper"></i> 报纸头部设置</h3>
                        <div>
                            <span style="margin-right: 10px; font-size: 0.9rem;">显示头部</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="headerVisible" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="control-subtitle">自定义报纸头部（报头、期号、日期等）</div>
                    <div class="control-row">
                        <div class="control-item">
                            <label for="paperName">报纸名称</label>
                            <input type="text" id="paperName" placeholder="请输入报纸名称..." value="XX日报">
                        </div>
                        <div class="control-item">
                            <label for="paperNameFontSize">名称字号：<span id="paperNameSizeValue" class="size-value">56</span>px</label>
                            <div class="font-size-control">
                                <input type="range" id="paperNameFontSize" min="24" max="96" value="56">
                            </div>
                        </div>
                    </div>
                    <div class="control-row">
                        <div class="control-item">
                            <label for="paperNameFontFamily">名称字体</label>
                            <select id="paperNameFontFamily">
                                <option value="'Playfair Display', serif">古典衬线体</option>
                                <option value="'Times New Roman', serif">Times New Roman</option>
                                <option value="'Noto Serif SC', serif">思源宋体</option>
                                <option value="'Roboto', sans-serif">现代无衬线体</option>
                                <option value="'Courier New', monospace">打字机体</option>
                                <option value="'Comic Neue', cursive">手写体</option>
                            </select>
                            <div id="paperNameFontPreview" class="font-preview">报纸名称字体预览</div>
                        </div>
                        <div class="control-item">
                            <label for="paperNameColor">名称颜色</label>
                            <div class="color-picker-container">
                                <input type="color" id="paperNameColor" class="color-picker" value="#222222">
                                <span id="paperNameColorValue" class="color-value">#222222</span>
                            </div>
                            <div id="paperNameColorPreview" class="color-preview" style="background-color: #222222;"></div>
                        </div>
                    </div>
                    <div class="control-row">
                        <div class="control-item">
                            <label for="paperDateText">报纸期号与日期</label>
                            <input type="text" id="paperDateText" placeholder="请输入期号和日期..." value="第XXXX期 · XXXX专刊 · XXXX年XX月XX日（这里依然也是可以碎碎念，写'作者xxx'也可以，什么都行）">
                        </div>
                        <div class="control-item">
                            <label for="paperDateFontSize">期号字号：<span id="paperDateSizeValue" class="size-value">18</span>px</label>
                            <div class="font-size-control">
                                <input type="range" id="paperDateFontSize" min="12" max="36" value="18">
                            </div>
                        </div>
                    </div>
                    <div class="control-row">
                        <div class="control-item">
                            <label for="paperDateFontFamily">期号字体</label>
                            <select id="paperDateFontFamily">
                                <option value="'Noto Serif SC', serif">思源宋体</option>
                                <option value="'Times New Roman', serif">Times New Roman</option>
                                <option value="'Playfair Display', serif">古典衬线体</option>
                                <option value="'Roboto', sans-serif">现代无衬线体</option>
                                <option value="'Courier New', monospace">打字机体</option>
                            </select>
                            <div id="paperDateFontPreview" class="font-preview">期号字体预览</div>
                        </div>
                        <div class="control-item">
                            <label for="paperDateColor">期号颜色</label>
                            <div class="color-picker-container">
                                <input type="color" id="paperDateColor" class="color-picker" value="#666666">
                                <span id="paperDateColorValue" class="color-value">#666666</span>
                            </div>
                            <div id="paperDateColorPreview" class="color-preview" style="background-color: #666666;"></div>
                        </div>
                    </div>
                    <!-- 新增：副标题显示/隐藏开关 -->
                    <div class="control-row">
                        <div class="control-item">
                            <label for="subtitleVisible" style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="subtitleVisible" checked>
                                <span>显示副标题/期号与日期</span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="control-group control-group-title">
                    <div class="control-group-header-content">
                        <h3><i class="fas fa-heading"></i> 标题样式设置</h3>
                    </div>
                    <div class="control-row">
                        <div class="control-item">
                            <label for="articleTitle">文章标题</label>
                            <input type="text" id="articleTitle" placeholder="请输入文章标题..." value="这里是文章标题">
                        </div>
                    </div>
                    <div class="control-row">
                        <div class="control-item">
                            <label for="titleFontSize">标题字号：<span id="titleSizeValue" class="size-value">48</span>px</label>
                            <div class="font-size-control">
                                <input type="range" id="titleFontSize" min="24" max="72" value="48">
                            </div>
                        </div>
                        <div class="control-item">
                            <label for="titleFontFamily">标题字体</label>
                            <select id="titleFontFamily">
                                <option value="'Playfair Display', serif">古典衬线体</option>
                                <option value="'Noto Serif SC', serif">思源宋体</option>
                                <option value="'Roboto', sans-serif">现代无衬线体</option>
                                <option value="'Source Code Pro', monospace">等宽字体</option>
                                <option value="'Comic Neue', cursive">手写体</option>
                            </select>
                            <div id="titleFontPreview" class="font-preview">标题字体预览</div>
                        </div>
                    </div>
                    <div class="control-row">
                        <div class="control-item">
                            <label for="titleColor">标题颜色</label>
                            <div class="color-picker-container">
                                <input type="color" id="titleColor" class="color-picker" value="#222222">
                                <span id="titleColorValue" class="color-value">#222222</span>
                            </div>
                            <div id="titleColorPreview" class="color-preview" style="background-color: #222222;"></div>
                        </div>
                        <div class="control-item">
                            <label for="titleAlign">标题对齐</label>
                            <select id="titleAlign">
                                <option value="center">居中</option>
                                <option value="left">左对齐</option>
                                <option value="right">右对齐</option>
                                <option value="justify">两端对齐</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="control-group control-group-text">
                    <div class="control-group-header-content">
                        <h3><i class="fas fa-paragraph"></i> 正文样式设置</h3>
                    </div>
                    <div class="control-row">
                        <div class="control-item">
                            <label for="articleContent">文章内容</label>
                            <textarea id="articleContent" placeholder="请输入文章内容...">总之这里就是正文了！
电脑上的预览是横屏输出的，输出也可以多栏式的排版，手机上似乎是默认竖着。
</textarea>
                        </div>
                    </div>
                    <div class="control-row">
                        <div class="control-item">
                            <label for="contentFontSize">正文字号：<span id="contentSizeValue" class="size-value">16</span>px</label>
                            <div class="font-size-control">
                                <input type="range" id="contentFontSize" min="12" max="24" value="16">
                            </div>
                        </div>
                        <div class="control-item">
                            <label for="contentFontFamily">正文字体</label>
                            <select id="contentFontFamily">
                                <option value="'Noto Serif SC', serif">思源宋体</option>
                                <option value="'Playfair Display', serif">古典衬线体</option>
                                <option value="'Roboto', sans-serif">现代无衬线体</option>
                                <option value="'Source Code Pro', monospace">等宽字体</option>
                            </select>
                            <div id="contentFontPreview" class="font-preview">正文字体预览</div>
                        </div>
                    </div>
                    <div class="control-row">
                        <div class="control-item">
                            <label for="contentColor">正文颜色</label>
                            <div class="color-picker-container">
                                <input type="color" id="contentColor" class="color-picker" value="#333333">
                                <span id="contentColorValue" class="color-value">#333333</span>
                            </div>
                            <div id="contentColorPreview" class="color-preview" style="background-color: #333333;"></div>
                        </div>
                        <div class="control-item">
                            <label for="lineHeight">行高</label>
                            <div class="font-size-control">
                                <input type="range" id="lineHeight" min="1.2" max="2.0" step="0.1" value="1.6">
                                <span id="lineHeightValue" class="size-value">1.6</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="control-group control-group-footer">
                    <div class="control-group-header-content">
                        <h3><i class="fas fa-info-circle"></i> 底部信息设置</h3>
                        <div>
                            <span style="margin-right: 10px; font-size: 0.9rem;">显示底部信息</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="footerVisible" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="control-subtitle">控制是否显示报纸底部的生成信息</div>
                    <div class="control-row">
                        <div class="control-item">
                            <label for="footerText">自定义底部信息</label>
                            <input type="text" id="footerText" placeholder="请输入自定义底部信息..." value="本报纸由「XX日报生成器」创建于">
                        </div>
                    </div>
                    <!-- 新增：是否添加日期复选框 -->
                    <div class="control-row">
                        <div class="control-item">
                            <label for="showFooterDate" style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="showFooterDate" checked>
                                <span>在底部信息后添加生成日期</span>
                            </label>
                        </div>
                    </div>
                    <div class="control-row">
                        <div class="control-item">
                            <label for="footerFontSize">底部信息字号：<span id="footerSizeValue" class="size-value">14</span>px</label>
                            <div class="font-size-control">
                                <input type="range" id="footerFontSize" min="10" max="24" value="14">
                            </div>
                        </div>
                        <div class="control-item">
                            <label for="footerColor">底部信息颜色</label>
                            <div class="color-picker-container">
                                <input type="color" id="footerColor" class="color-picker" value="#666666">
                                <span id="footerColorValue" class="color-value">#666666</span>
                            </div>
                            <div id="footerColorPreview" class="color-preview" style="background-color: #666666;"></div>
                        </div>
                    </div>
                </div>
                <!-- 修改：添加保存和加载按钮 -->
                <div class="buttons">
                    <button class="generate-btn" id="generateBtn">
                        <i class="fas fa-magic"></i> 生成报纸
                    </button>
                    <button class="download-btn" id="downloadBtn">
                        <i class="fas fa-download"></i> 下载图片
                    </button>
                    <button class="save-btn" id="saveBtn">
                        <i class="fas fa-save"></i> 储存内容
                    </button>
                    <button class="load-btn" id="loadBtn">
                        <i class="fas fa-folder-open"></i> 加载内容
                    </button>
                    <button class="reset-btn" id="resetBtn">
                        <i class="fas fa-redo"></i> 重置
                    </button>
                </div>
            </div>
            <div class="newspaper-preview">
                <h2 class="section-title"><i class="fas fa-eye"></i> 报纸预览（实时更新）</h2>
                <div class="newspaper" id="newspaper">
                    <div class="newspaper-content">
                        <div class="newspaper-header" id="newspaperHeader">
                            <h1 class="paper-name" id="previewPaperName">XX日报</h1>
                            <p class="paper-date" id="previewPaperDate">第XXXX期 · XXXX专刊 · XXXX年XX月XX日（这里依然也是可以碎碎念，写'作者xxx'也可以，什么都行）</p>
                        </div>
                        <h2 class="article-title" id="previewTitle">这里是文章标题</h2>
                        <div class="article-content">
                            <div class="article-image-container" id="articleImageContainer">
                                <img id="previewImage" class="article-image" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAwIiBoZWlnaHQ9IjQwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiPjxyZWN0IHdpZHRoPSI2MDAiIGhlaWdodD0iNDAwIiBmaWxsPSIjZjBmMGYwIi8+PHRleHQgeD0iMzAwIiB5PSIyMDAiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIyNCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0iIzgwODA4MCI+UElDVFVSRSBQTEFDRUhPTERFUjwvdGV4dD48L3N2Zz4=" alt="报纸插图">
                                <p id="previewCaption" class="article-image-caption">上面可以插入图片，这里可以输入图片备注（当然吐槽碎碎念也没问题。</p>
                            </div>
                            <div class="article-text" id="previewContent">
                                <p>总之这里就是正文了！</p>
                                <p>电脑上的预览是横屏输出的，输出也可以多栏式的排版，手机上似乎是默认竖着。</p>
                            </div>
                        </div>
                        <div class="newspaper-footer" id="newspaperFooter">
                            <p class="generated-date" id="previewFooterText">本报纸由「XX日报生成器」创建于 <span id="generationDate">2026年1月25日</span></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 新增：错误弹窗 -->
        <div class="error-modal" id="errorModal">
            <div class="error-content">
                <div class="error-header">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>图片生成错误</h3>
                </div>
                <p>抱歉，生成图片时遇到了问题。以下是可能的错误原因和解决方案：</p>
                <div class="error-details" id="errorDetails">
                    <!-- 错误详情将动态填充到这里 -->
                </div>
                <div class="error-solution">
                    <h4>可能的解决方案：</h4>
                    <ul id="errorSolution">
                        <!-- 解决方案将动态填充到这里 -->
                    </ul>
                </div>
                <div class="error-buttons">
                    <button class="error-btn error-btn-secondary" id="closeErrorBtn">关闭</button>
                    <button class="error-btn error-btn-primary" id="retryBtn">重试</button>
                </div>
            </div>
        </div>
        
        <div class="toast" id="toast">报纸已更新！</div>
        <footer>
            <p>工具制作：@村里最乱炒的坏厨</p>
            <p>提示：所有设置更改会自动实时预览，点击"下载图片"将保存为PNG格式</p>
        </footer>
    </div>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script>
        // 获取DOM元素
        const imageInput = document.getElementById('imageInput');
        const imageUpload = document.getElementById('imageUpload');
        const imagePreview = document.getElementById('imagePreview');
        const imageCaption = document.getElementById('imageCaption');
        const imageVisible = document.getElementById('imageVisible');
        
        // 报纸头部控件
        const headerVisible = document.getElementById('headerVisible');
        const paperName = document.getElementById('paperName');
        const paperNameFontSize = document.getElementById('paperNameFontSize');
        const paperNameFontFamily = document.getElementById('paperNameFontFamily');
        const paperNameColor = document.getElementById('paperNameColor');
        const paperNameSizeValue = document.getElementById('paperNameSizeValue');
        const paperNameColorValue = document.getElementById('paperNameColorValue');
        const paperNameColorPreview = document.getElementById('paperNameColorPreview');
        const paperNameFontPreview = document.getElementById('paperNameFontPreview');
        const paperDateText = document.getElementById('paperDateText');
        const paperDateFontSize = document.getElementById('paperDateFontSize');
        const paperDateFontFamily = document.getElementById('paperDateFontFamily');
        const paperDateColor = document.getElementById('paperDateColor');
        const paperDateSizeValue = document.getElementById('paperDateSizeValue');
        const paperDateColorValue = document.getElementById('paperDateColorValue');
        const paperDateColorPreview = document.getElementById('paperDateColorPreview');
        const paperDateFontPreview = document.getElementById('paperDateFontPreview');
        
        // 新增：副标题显示/隐藏控件
        const subtitleVisible = document.getElementById('subtitleVisible');
        
        // 标题控件
        const articleTitle = document.getElementById('articleTitle');
        const titleFontSize = document.getElementById('titleFontSize');
        const titleFontFamily = document.getElementById('titleFontFamily');
        const titleColor = document.getElementById('titleColor');
        const titleAlign = document.getElementById('titleAlign');
        const titleSizeValue = document.getElementById('titleSizeValue');
        const titleColorValue = document.getElementById('titleColorValue');
        const titleColorPreview = document.getElementById('titleColorPreview');
        const titleFontPreview = document.getElementById('titleFontPreview');
        
        // 正文控件
        const articleContent = document.getElementById('articleContent');
        const contentFontSize = document.getElementById('contentFontSize');
        const contentFontFamily = document.getElementById('contentFontFamily');
        const contentColor = document.getElementById('contentColor');
        const lineHeight = document.getElementById('lineHeight');
        const contentSizeValue = document.getElementById('contentSizeValue');
        const contentColorValue = document.getElementById('contentColorValue');
        const contentColorPreview = document.getElementById('contentColorPreview');
        const contentFontPreview = document.getElementById('contentFontPreview');
        const lineHeightValue = document.getElementById('lineHeightValue');
        
        // 底部信息控件
        const footerVisible = document.getElementById('footerVisible');
        const footerText = document.getElementById('footerText');
        const footerFontSize = document.getElementById('footerFontSize');
        const footerColor = document.getElementById('footerColor');
        const footerSizeValue = document.getElementById('footerSizeValue');
        const footerColorValue = document.getElementById('footerColorValue');
        const footerColorPreview = document.getElementById('footerColorPreview');
        
        // 新增：底部日期显示/隐藏控件
        const showFooterDate = document.getElementById('showFooterDate');
        
        // 按钮和预览
        const generateBtn = document.getElementById('generateBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const saveBtn = document.getElementById('saveBtn'); // 新增
        const loadBtn = document.getElementById('loadBtn'); // 新增
        const resetBtn = document.getElementById('resetBtn');
        const newspaperHeader = document.getElementById('newspaperHeader');
        const previewPaperName = document.getElementById('previewPaperName');
        const previewPaperDate = document.getElementById('previewPaperDate');
        const previewTitle = document.getElementById('previewTitle');
        const articleImageContainer = document.getElementById('articleImageContainer');
        const previewImage = document.getElementById('previewImage');
        const previewCaption = document.getElementById('previewCaption');
        const previewContent = document.getElementById('previewContent');
        const newspaperFooter = document.getElementById('newspaperFooter');
        const previewFooterText = document.getElementById('previewFooterText');
        const generationDate = document.getElementById('generationDate');
        const toast = document.getElementById('toast');
        
        // 新增：布局切换控件
        const horizontalLayoutBtn = document.getElementById('horizontalLayoutBtn');
        const verticalLayoutBtn = document.getElementById('verticalLayoutBtn');
        const mainContent = document.querySelector('.main-content');
        const container = document.querySelector('.container');
        
        // 新增：错误弹窗控件
        const errorModal = document.getElementById('errorModal');
        const errorDetails = document.getElementById('errorDetails');
        const errorSolution = document.getElementById('errorSolution');
        const closeErrorBtn = document.getElementById('closeErrorBtn');
        const retryBtn = document.getElementById('retryBtn');
        
        // 初始化字体预览
        updateFontPreview(paperNameFontPreview, paperNameFontFamily.value);
        updateFontPreview(paperDateFontPreview, paperDateFontFamily.value);
        updateFontPreview(titleFontPreview, titleFontFamily.value);
        updateFontPreview(contentFontPreview, contentFontFamily.value);
        
        // 设置生成日期
        const now = new Date();
        const formattedDate = `${now.getFullYear()}年${now.getMonth()+1}月${now.getDate()}日`;
        generationDate.textContent = formattedDate;
        
        // 页面加载时检查是否有保存的内容
        window.addEventListener('DOMContentLoaded', () => {
            // 检查是否有保存的数据
            if (localStorage.getItem('newspaperSettings') && confirm('检测到上次保存的报纸设置，是否恢复？')) {
                loadSettings();
            }
            
            // 更新颜色预览
            paperNameColorPreview.style.backgroundColor = paperNameColor.value;
            paperDateColorPreview.style.backgroundColor = paperDateColor.value;
            titleColorPreview.style.backgroundColor = titleColor.value;
            contentColorPreview.style.backgroundColor = contentColor.value;
            footerColorPreview.style.backgroundColor = footerColor.value;
            
            // 应用所有样式并初始化报纸
            applyAllStyles();
            updateNewspaper();
        });
        
        // 新增：布局切换功能
        horizontalLayoutBtn.addEventListener('click', function() {
            container.classList.remove('vertical-layout');
            horizontalLayoutBtn.classList.add('active');
            verticalLayoutBtn.classList.remove('active');
            showToast('已切换为左右布局');
        });
        
        verticalLayoutBtn.addEventListener('click', function() {
            container.classList.add('vertical-layout');
            verticalLayoutBtn.classList.add('active');
            horizontalLayoutBtn.classList.remove('active');
            showToast('已切换为上下布局');
        });
        
        // 新增：副标题显示/隐藏控制
        subtitleVisible.addEventListener('change', function() {
            previewPaperDate.style.display = this.checked ? 'block' : 'none';
            updateNewspaper();
        });
        
        // 新增：底部日期显示/隐藏控制
        showFooterDate.addEventListener('change', function() {
            updateFooterText();
        });
        
        // 图片显示/隐藏控制
        imageVisible.addEventListener('change', function() {
            if (this.checked) {
                articleImageContainer.style.display = 'block';
                previewContent.classList.remove('no-image');
            } else {
                articleImageContainer.style.display = 'none';
                previewContent.classList.add('no-image');
            }
            updateNewspaper();
        });
        
        // 图片上传功能
        imageUpload.addEventListener('click', () => {
            imageInput.click();
        });
        
        imageInput.addEventListener('change', function() {
            if (this.files && this.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    imagePreview.src = e.target.result;
                    imagePreview.style.display = 'block';
                    previewImage.src = e.target.result;
                    updateNewspaper();
                    showToast('图片上传成功！');
                };
                reader.readAsDataURL(this.files[0]);
            }
        });
        
        // 支持拖放上传
        imageUpload.addEventListener('dragover', (e) => {
            e.preventDefault();
            imageUpload.style.borderColor = '#8c2e2e';
        });
        
        imageUpload.addEventListener('dragleave', () => {
            imageUpload.style.borderColor = '#d4c9b8';
        });
        
        imageUpload.addEventListener('drop', (e) => {
            e.preventDefault();
            imageUpload.style.borderColor = '#d4c9b8';
            if (e.dataTransfer.files.length) {
                imageInput.files = e.dataTransfer.files;
                const reader = new FileReader();
                reader.onload = function(e) {
                    imagePreview.src = e.target.result;
                    imagePreview.style.display = 'block';
                    previewImage.src = e.target.result;
                    updateNewspaper();
                    showToast('图片上传成功！');
                };
                reader.readAsDataURL(e.dataTransfer.files[0]);
            }
        });
        
        // 报纸头部控制
        headerVisible.addEventListener('change', function() {
            newspaperHeader.style.display = this.checked ? 'block' : 'none';
            updateNewspaper();
        });
        
        paperNameFontSize.addEventListener('input', function() {
            paperNameSizeValue.textContent = this.value;
            previewPaperName.style.fontSize = `${this.value}px`;
            updateNewspaper();
        });
        
        paperNameFontFamily.addEventListener('change', function() {
            updateFontPreview(paperNameFontPreview, this.value);
            previewPaperName.style.fontFamily = this.value;
            updateNewspaper();
        });
        
        paperNameColor.addEventListener('input', function() {
            paperNameColorValue.textContent = this.value;
            paperNameColorPreview.style.backgroundColor = this.value;
            previewPaperName.style.color = this.value;
            updateNewspaper();
        });
        
        paperDateFontSize.addEventListener('input', function() {
            paperDateSizeValue.textContent = this.value;
            previewPaperDate.style.fontSize = `${this.value}px`;
            updateNewspaper();
        });
        
        paperDateFontFamily.addEventListener('change', function() {
            updateFontPreview(paperDateFontPreview, this.value);
            previewPaperDate.style.fontFamily = this.value;
            updateNewspaper();
        });
        
        paperDateColor.addEventListener('input', function() {
            paperDateColorValue.textContent = this.value;
            paperDateColorPreview.style.backgroundColor = this.value;
            previewPaperDate.style.color = this.value;
            updateNewspaper();
        });
        
        // 标题样式控制
        titleFontSize.addEventListener('input', function() {
            titleSizeValue.textContent = this.value;
            previewTitle.style.fontSize = `${this.value}px`;
            updateNewspaper();
        });
        
        titleFontFamily.addEventListener('change', function() {
            updateFontPreview(titleFontPreview, this.value);
            previewTitle.style.fontFamily = this.value;
            updateNewspaper();
        });
        
        titleColor.addEventListener('input', function() {
            titleColorValue.textContent = this.value;
            titleColorPreview.style.backgroundColor = this.value;
            previewTitle.style.color = this.value;
            updateNewspaper();
        });
        
        titleAlign.addEventListener('change', function() {
            previewTitle.style.textAlign = this.value;
            updateNewspaper();
        });
        
        // 正文样式控制
        contentFontSize.addEventListener('input', function() {
            contentSizeValue.textContent = this.value;
            previewContent.style.fontSize = `${this.value}px`;
            updateNewspaper();
        });
        
        contentFontFamily.addEventListener('change', function() {
            updateFontPreview(contentFontPreview, this.value);
            previewContent.style.fontFamily = this.value;
            updateNewspaper();
        });
        
        contentColor.addEventListener('input', function() {
            contentColorValue.textContent = this.value;
            contentColorPreview.style.backgroundColor = this.value;
            previewContent.style.color = this.value;
            updateNewspaper();
        });
        
        lineHeight.addEventListener('input', function() {
            lineHeightValue.textContent = this.value;
            previewContent.style.lineHeight = this.value;
            updateNewspaper();
        });
        
        // 底部信息控制
        footerVisible.addEventListener('change', function() {
            newspaperFooter.style.display = this.checked ? 'block' : 'none';
            updateNewspaper();
        });
        
        footerFontSize.addEventListener('input', function() {
            footerSizeValue.textContent = this.value;
            previewFooterText.style.fontSize = `${this.value}px`;
            updateNewspaper();
        });
        
        footerColor.addEventListener('input', function() {
            footerColorValue.textContent = this.value;
            footerColorPreview.style.backgroundColor = this.value;
            previewFooterText.style.color = this.value;
            updateNewspaper();
        });
        
        footerText.addEventListener('input', function() {
            updateFooterText();
        });
        
        // 更新底部文本的函数
        function updateFooterText() {
            const footerContent = footerText.value ? footerText.value : "本报纸由「XX日报生成器」创建于";
            if (showFooterDate.checked) {
                previewFooterText.innerHTML = `${footerContent} <span id="generationDate">${generationDate.textContent}</span>`;
            } else {
                previewFooterText.innerHTML = footerContent;
            }
            updateNewspaper();
        }
        
        // 文本内容实时更新
        paperName.addEventListener('input', function() {
            previewPaperName.textContent = this.value || "报纸名称";
            updateNewspaper();
        });
        
        paperDateText.addEventListener('input', function() {
            previewPaperDate.textContent = this.value || "日期信息";
            updateNewspaper();
        });
        
        articleTitle.addEventListener('input', function() {
            previewTitle.textContent = this.value || "文章标题";
            updateNewspaper();
        });
        
        imageCaption.addEventListener('input', function() {
            previewCaption.textContent = this.value || "图片说明";
            updateNewspaper();
        });
        
        articleContent.addEventListener('input', function() {
            const contentText = this.value || "文章内容为空，请在上方编辑区域输入内容。";
            const paragraphs = contentText.split('\n').filter(p => p.trim() !== '');
            previewContent.innerHTML = '';
            paragraphs.forEach(paragraph => {
                const p = document.createElement('p');
                p.textContent = paragraph;
                previewContent.appendChild(p);
            });
            updateNewspaper();
        });

        // 更新字体预览
        function updateFontPreview(previewElement, fontFamily) {
            previewElement.style.fontFamily = fontFamily;
            
            // 获取字体名称显示
            let fontName = "自定义字体";
            if (fontFamily.includes('Playfair Display')) fontName = "古典衬线体";
            else if (fontFamily.includes('Times New Roman')) fontName = "Times New Roman";
            else if (fontFamily.includes('Noto Serif SC')) fontName = "思源宋体";
            else if (fontFamily.includes('Roboto')) fontName = "现代无衬线体";
            else if (fontFamily.includes('Courier New')) fontName = "打字机体";
            else if (fontFamily.includes('Source Code Pro')) fontName = "等宽字体";
            else if (fontFamily.includes('Comic Neue')) fontName = "手写体";
            previewElement.textContent = fontName;
        }
        
        // 生成报纸预览
        generateBtn.addEventListener('click', function() {
            // 强制重新应用所有样式到预览
            applyAllStyles();
            updateNewspaper();
            showToast('报纸已重新生成！');
        });
        
        // 新增：保存设置到本地存储
        saveBtn.addEventListener('click', function() {
            const settings = collectAllSettings();
            localStorage.setItem('newspaperSettings', JSON.stringify(settings));
            showToast('设置已保存到浏览器本地存储！');
        });
        
        // 新增：从本地存储加载设置
        loadBtn.addEventListener('click', function() {
            if (confirm('确定要加载上次保存的设置吗？这将覆盖当前的设置。')) {
                loadSettings();
            }
        });
        
        // 收集所有设置
        function collectAllSettings() {
            const settings = {
                // 图片设置
                imageVisible: imageVisible.checked,
                imageCaption: imageCaption.value,
                // 如果有图片，保存图片的base64数据
                imageData: imagePreview.src.startsWith('data:image') ? imagePreview.src : null,
                
                // 报纸头部设置
                headerVisible: headerVisible.checked,
                paperName: paperName.value,
                paperNameFontSize: paperNameFontSize.value,
                paperNameFontFamily: paperNameFontFamily.value,
                paperNameColor: paperNameColor.value,
                paperDateText: paperDateText.value,
                paperDateFontSize: paperDateFontSize.value,
                paperDateFontFamily: paperDateFontFamily.value,
                paperDateColor: paperDateColor.value,
                subtitleVisible: subtitleVisible.checked,
                
                // 标题样式设置
                articleTitle: articleTitle.value,
                titleFontSize: titleFontSize.value,
                titleFontFamily: titleFontFamily.value,
                titleColor: titleColor.value,
                titleAlign: titleAlign.value,
                
                // 正文样式设置
                articleContent: articleContent.value,
                contentFontSize: contentFontSize.value,
                contentFontFamily: contentFontFamily.value,
                contentColor: contentColor.value,
                lineHeight: lineHeight.value,
                
                // 底部信息设置
                footerVisible: footerVisible.checked,
                footerText: footerText.value,
                footerFontSize: footerFontSize.value,
                footerColor: footerColor.value,
                showFooterDate: showFooterDate.checked,
                
                // 布局设置
                layout: container.classList.contains('vertical-layout') ? 'vertical' : 'horizontal'
            };
            return settings;
        }
        
        // 加载设置
        function loadSettings() {
            const savedSettings = localStorage.getItem('newspaperSettings');
            if (!savedSettings) {
                showToast('没有找到保存的设置！');
                return;
            }
            
            try {
                const settings = JSON.parse(savedSettings);
                
                // 图片设置
                imageVisible.checked = settings.imageVisible;
                imageCaption.value = settings.imageCaption;
                if (settings.imageData) {
                    imagePreview.src = settings.imageData;
                    imagePreview.style.display = 'block';
                    previewImage.src = settings.imageData;
                }
                articleImageContainer.style.display = settings.imageVisible ? 'block' : 'none';
                previewContent.classList.toggle('no-image', !settings.imageVisible);
                
                // 报纸头部设置
                headerVisible.checked = settings.headerVisible;
                paperName.value = settings.paperName;
                paperNameFontSize.value = settings.paperNameFontSize;
                paperNameSizeValue.textContent = settings.paperNameFontSize;
                paperNameFontFamily.value = settings.paperNameFontFamily;
                updateFontPreview(paperNameFontPreview, settings.paperNameFontFamily);
                paperNameColor.value = settings.paperNameColor;
                paperNameColorValue.textContent = settings.paperNameColor;
                paperNameColorPreview.style.backgroundColor = settings.paperNameColor;
                
                paperDateText.value = settings.paperDateText;
                paperDateFontSize.value = settings.paperDateFontSize;
                paperDateSizeValue.textContent = settings.paperDateFontSize;
                paperDateFontFamily.value = settings.paperDateFontFamily;
                updateFontPreview(paperDateFontPreview, settings.paperDateFontFamily);
                paperDateColor.value = settings.paperDateColor;
                paperDateColorValue.textContent = settings.paperDateColor;
                paperDateColorPreview.style.backgroundColor = settings.paperDateColor;
                
                subtitleVisible.checked = settings.subtitleVisible !== undefined ? settings.subtitleVisible : true;
                previewPaperDate.style.display = subtitleVisible.checked ? 'block' : 'none';
                
                newspaperHeader.style.display = settings.headerVisible ? 'block' : 'none';
                
                // 标题样式设置
                articleTitle.value = settings.articleTitle;
                titleFontSize.value = settings.titleFontSize;
                titleSizeValue.textContent = settings.titleFontSize;
                titleFontFamily.value = settings.titleFontFamily;
                updateFontPreview(titleFontPreview, settings.titleFontFamily);
                titleColor.value = settings.titleColor;
                titleColorValue.textContent = settings.titleColor;
                titleColorPreview.style.backgroundColor = settings.titleColor;
                titleAlign.value = settings.titleAlign;
                
                // 正文样式设置
                articleContent.value = settings.articleContent;
                contentFontSize.value = settings.contentFontSize;
                contentSizeValue.textContent = settings.contentFontSize;
                contentFontFamily.value = settings.contentFontFamily;
                updateFontPreview(contentFontPreview, settings.contentFontFamily);
                contentColor.value = settings.contentColor;
                contentColorValue.textContent = settings.contentColor;
                contentColorPreview.style.backgroundColor = settings.contentColor;
                lineHeight.value = settings.lineHeight;
                lineHeightValue.textContent = settings.lineHeight;
                
                // 底部信息设置
                footerVisible.checked = settings.footerVisible;
                footerText.value = settings.footerText;
                footerFontSize.value = settings.footerFontSize;
                footerSizeValue.textContent = settings.footerFontSize;
                footerColor.value = settings.footerColor;
                footerColorValue.textContent = settings.footerColor;
                footerColorPreview.style.backgroundColor = settings.footerColor;
                newspaperFooter.style.display = settings.footerVisible ? 'block' : 'none';
                
                // 新增：底部日期显示/隐藏设置
                showFooterDate.checked = settings.showFooterDate !== undefined ? settings.showFooterDate : true;
                
                // 布局设置
                if (settings.layout === 'vertical') {
                    container.classList.add('vertical-layout');
                    verticalLayoutBtn.classList.add('active');
                    horizontalLayoutBtn.classList.remove('active');
                } else {
                    container.classList.remove('vertical-layout');
                    horizontalLayoutBtn.classList.add('active');
                    verticalLayoutBtn.classList.remove('active');
                }
                
                // 更新预览
                applyAllStyles();
                updateNewspaper();
                showToast('设置已加载！');
            } catch (error) {
                console.error('加载设置时出错:', error);
                showToast('加载设置失败，数据可能已损坏！');
            }
        }
        
        // 应用所有样式的函数
        function applyAllStyles() {
            // 应用图片显示/隐藏
            articleImageContainer.style.display = imageVisible.checked ? 'block' : 'none';
            previewContent.classList.toggle('no-image', !imageVisible.checked);
            
            // 应用报纸头部显示/隐藏
            newspaperHeader.style.display = headerVisible.checked ? 'block' : 'none';
            
            // 应用报纸名称样式
            previewPaperName.textContent = paperName.value || "报纸名称";
            previewPaperName.style.fontSize = `${paperNameFontSize.value}px`;
            previewPaperName.style.fontFamily = paperNameFontFamily.value;
            previewPaperName.style.color = paperNameColor.value;
            
            // 应用报纸日期样式
            previewPaperDate.textContent = paperDateText.value || "日期信息";
            previewPaperDate.style.fontSize = `${paperDateFontSize.value}px`;
            previewPaperDate.style.fontFamily = paperDateFontFamily.value;
            previewPaperDate.style.color = paperDateColor.value;
            previewPaperDate.style.display = subtitleVisible.checked ? 'block' : 'none';
            
            // 应用标题样式
            previewTitle.textContent = articleTitle.value || "文章标题";
            previewTitle.style.fontSize = `${titleFontSize.value}px`;
            previewTitle.style.fontFamily = titleFontFamily.value;
            previewTitle.style.color = titleColor.value;
            previewTitle.style.textAlign = titleAlign.value;
            
            // 应用图片说明
            previewCaption.textContent = imageCaption.value || "图片说明";
            
            // 应用正文内容
            const contentText = articleContent.value || "文章内容为空，请在上方编辑区域输入内容。";
            const paragraphs = contentText.split('\n').filter(p => p.trim() !== '');
            previewContent.innerHTML = '';
            paragraphs.forEach(paragraph => {
                const p = document.createElement('p');
                p.textContent = paragraph;
                previewContent.appendChild(p);
            });
            
            // 应用正文字体样式
            previewContent.style.fontSize = `${contentFontSize.value}px`;
            previewContent.style.fontFamily = contentFontFamily.value;
            previewContent.style.color = contentColor.value;
            previewContent.style.lineHeight = lineHeight.value;
            
            // 应用底部信息样式
            newspaperFooter.style.display = footerVisible.checked ? 'block' : 'none';
            updateFooterText();
            previewFooterText.style.fontSize = `${footerFontSize.value}px`;
            previewFooterText.style.color = footerColor.value;
            
            // 更新生成日期
            const now = new Date();
            const formattedDate = `${now.getFullYear()}年${now.getMonth()+1}月${now.getDate()}日`;
            generationDate.textContent = formattedDate;
        }
        
        // 更新报纸预览
        function updateNewspaper() {
            // 显示一个明显的视觉反馈
            const newspaperElement = document.getElementById('newspaper');
            const originalTransform = newspaperElement.style.transform;
            const originalBoxShadow = newspaperElement.style.boxShadow;
            
            // 添加动画效果
            newspaperElement.style.transform = 'scale(1.02)';
            newspaperElement.style.boxShadow = '0 0 30px rgba(140, 46, 46, 0.3)';
            
            setTimeout(() => {
                newspaperElement.style.transform = originalTransform;
                newspaperElement.style.boxShadow = originalBoxShadow;
            }, 300);
        }
        
        // 新增：显示错误弹窗
        function showErrorModal(error, retryFunction) {
            errorDetails.innerHTML = `
                <p><strong>错误类型：</strong>${error.type || '未知错误'}</p>
                <p><strong>错误消息：</strong>${error.message || '未知错误消息'}</p>
                <p><strong>错误详情：</strong>${error.details || '无详细错误信息'}</p>
            `;
            
            errorSolution.innerHTML = `
                <li>检查网络连接是否正常</li>
                <li>尝试减小图片尺寸或分辨率</li>
                <li>关闭浏览器插件，特别是广告拦截器</li>
                <li>尝试使用不同的浏览器（推荐Chrome或Firefox）</li>
                <li>如果包含外部图片，请确保图片URL可访问</li>
                <li>尝试等待几分钟后重试</li>
            `;
            
            errorModal.style.display = 'flex';
            
            // 设置重试按钮功能
            retryBtn.onclick = function() {
                errorModal.style.display = 'none';
                if (retryFunction) {
                    retryFunction();
                }
            };
            
            closeErrorBtn.onclick = function() {
                errorModal.style.display = 'none';
            };
            
            // 点击模态框外部关闭
            errorModal.addEventListener('click', function(e) {
                if (e.target === errorModal) {
                    errorModal.style.display = 'none';
                }
            });
        }
        
        // 下载报纸为图片
        downloadBtn.addEventListener('click', function() {
            showToast('正在生成图片，请稍候...');
            
            // 使用html2canvas将报纸转换为图片
            html2canvas(document.getElementById('newspaper'), {
                backgroundColor: '#faf8f2',
                scale: 2,
                useCORS: true,
                logging: false,
                onclone: function(clonedDoc) {
                    // 在克隆的文档中修复可能的问题
                    const clonedNewspaper = clonedDoc.getElementById('newspaper');
                    if (clonedNewspaper) {
                        // 确保所有字体都已加载
                        clonedNewspaper.style.fontFamily = document.getElementById('newspaper').style.fontFamily;
                    }
                }
            }).then(canvas => {
                // 创建下载链接
                const link = document.createElement('a');
                link.download = `同人报纸-${new Date().getTime()}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                showToast('图片下载完成！');
            }).catch(err => {
                console.error('生成图片时出错:', err);
                
                // 分析错误并提供详细的错误信息
                let errorInfo = {
                    type: 'html2canvas错误',
                    message: err.message || '未知错误',
                    details: ''
                };
                
                // 根据错误类型提供更详细的错误信息
                if (err.message && err.message.includes('CORS')) {
                    errorInfo.details = '跨域资源共享(CORS)错误。这可能是因为图片来自不同的域，浏览器出于安全原因阻止了访问。';
                } else if (err.message && err.message.includes('tainted')) {
                    errorInfo.details = '画布被污染错误。这可能是因为使用了跨域图片，且图片服务器未设置正确的CORS头部。';
                } else if (err.message && err.message.includes('timeout')) {
                    errorInfo.details = '操作超时。生成过程花费了太长时间。';
                } else if (err.message && err.message.includes('memory')) {
                    errorInfo.details = '内存不足。报纸内容可能太复杂或图片太大。';
                }
                
                // 显示错误弹窗
                showErrorModal(errorInfo, function() {
                    // 重试函数
                    downloadBtn.click();
                });
            });
        });
        
        // 重置所有设置
        resetBtn.addEventListener('click', function() {
            if (confirm('确定要重置所有设置吗？这将清除所有自定义内容。')) {
                // 重置图片相关设置
                imageVisible.checked = true;
                articleImageContainer.style.display = 'block';
                previewContent.classList.remove('no-image');
                imageCaption.value = "上面可以插入图片，这里可以输入图片备注（当然吐槽碎碎念也没问题。";
                previewCaption.textContent = "上面可以插入图片，这里可以输入图片备注（当然吐槽碎碎念也没问题。";
                
                // 重置图片
                imagePreview.style.display = 'none';
                previewImage.src = "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAwIiBoZWlnaHQ9IjQwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiPjxyZWN0IHdpZHRoPSI2MDAiIGhlaWdodD0iNDAwIiBmaWxsPSIjZjBmMGYwIi8+PHRleHQgeD0iMzAwIiB5PSIyMDAiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIyNCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0iIzgwODA4MCI+UElDVFVSRSBQTEFDRUhPTERFUjwvdGV4dD48L3N2Zz4=";
                
                // 重置报纸头部
                headerVisible.checked = true;
                newspaperHeader.style.display = 'block';
                paperName.value = "XX日报";
                previewPaperName.textContent = "XX日报";
                paperNameFontSize.value = 56;
                paperNameSizeValue.textContent = "56";
                previewPaperName.style.fontSize = "56px";
                paperNameFontFamily.value = "'Playfair Display', serif";
                updateFontPreview(paperNameFontPreview, paperNameFontFamily.value);
                previewPaperName.style.fontFamily = "'Playfair Display', serif";
                paperNameColor.value = "#222222";
                paperNameColorValue.textContent = "#222222";
                paperNameColorPreview.style.backgroundColor = "#222222";
                previewPaperName.style.color = "#222222";
                paperDateText.value = "第XXXX期 · XXXX专刊 · XXXX年XX月XX日（这里依然也是可以碎碎念，写'作者xxx'也可以，什么都行）";
                previewPaperDate.textContent = "第XXXX期 · XXXX专刊 · XXXX年XX月XX日（这里依然也是可以碎碎念，写'作者xxx'也可以，什么都行）";
                paperDateFontSize.value = 18;
                paperDateSizeValue.textContent = "18";
                previewPaperDate.style.fontSize = "18px";
                paperDateFontFamily.value = "'Noto Serif SC', serif";
                updateFontPreview(paperDateFontPreview, paperDateFontFamily.value);
                previewPaperDate.style.fontFamily = "'Noto Serif SC', serif";
                paperDateColor.value = "#666666";
                paperDateColorValue.textContent = "#666666";
                paperDateColorPreview.style.backgroundColor = "#666666";
                previewPaperDate.style.color = "#666666";
                subtitleVisible.checked = true;
                previewPaperDate.style.display = 'block';
                
                // 重置标题样式
                articleTitle.value = "这里是文章标题";
                previewTitle.textContent = "这里是文章标题";
                titleFontSize.value = 48;
                titleSizeValue.textContent = "48";
                previewTitle.style.fontSize = "48px";
                titleFontFamily.value = "'Playfair Display', serif";
                updateFontPreview(titleFontPreview, titleFontFamily.value);
                previewTitle.style.fontFamily = "'Playfair Display', serif";
                titleColor.value = "#222222";
                titleColorValue.textContent = "#222222";
                titleColorPreview.style.backgroundColor = "#222222";
                previewTitle.style.color = "#222222";
                titleAlign.value = "center";
                previewTitle.style.textAlign = "center";
                
                // 重置正文样式
                articleContent.value = `总之这里就是正文了！
电脑上的预览是横屏输出的，输出也可以多栏式的排版，手机上似乎是默认竖着。
`;
                
                // 更新文章内容
                const contentText = articleContent.value;
                const paragraphs = contentText.split('\n').filter(p => p.trim() !== '');
                previewContent.innerHTML = '';
                paragraphs.forEach(paragraph => {
                    const p = document.createElement('p');
                    p.textContent = paragraph;
                    previewContent.appendChild(p);
                });
                
                contentFontSize.value = 16;
                contentSizeValue.textContent = "16";
                previewContent.style.fontSize = "16px";
                contentFontFamily.value = "'Noto Serif SC', serif";
                updateFontPreview(contentFontPreview, contentFontFamily.value);
                previewContent.style.fontFamily = "'Noto Serif SC', serif";
                contentColor.value = "#333333";
                contentColorValue.textContent = "#333333";
                contentColorPreview.style.backgroundColor = "#333333";
                previewContent.style.color = "#333333";
                lineHeight.value = 1.6;
                lineHeightValue.textContent = "1.6";
                previewContent.style.lineHeight = "1.6";
                
                // 重置底部信息设置
                footerVisible.checked = true;
                newspaperFooter.style.display = 'block';
                footerText.value = "本报纸由「XX日报生成器」创建于";
                showFooterDate.checked = true;
                updateFooterText();
                footerFontSize.value = 14;
                footerSizeValue.textContent = "14";
                previewFooterText.style.fontSize = "14px";
                footerColor.value = "#666666";
                footerColorValue.textContent = "#666666";
                footerColorPreview.style.backgroundColor = "#666666";
                previewFooterText.style.color = "#666666";
                
                // 重置布局
                container.classList.remove('vertical-layout');
                horizontalLayoutBtn.classList.add('active');
                verticalLayoutBtn.classList.remove('active');
                
                // 更新生成日期
                const now = new Date();
                const formattedDate = `${now.getFullYear()}年${now.getMonth()+1}月${now.getDate()}日`;
                generationDate.textContent = formattedDate;
                
                // 应用所有样式并更新预览
                applyAllStyles();
                updateNewspaper();
                showToast('所有设置已重置！');
            }
        });
        
        // 显示提示消息
        function showToast(message) {
            toast.textContent = message;
            toast.style.display = 'block';
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }
    </script>
</body>
</html>